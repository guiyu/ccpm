# 命令参考

Claude Code PM 系统中所有可用命令的完整参考。

> **注意**：项目管理命令（`/pm:*`）在主要的 [README.md](README.md#command-reference) 中已有文档说明。

## 目录

- [上下文命令](#context-commands)
- [测试命令](#testing-commands)  
- [实用工具命令](#utility-commands)
- [审查命令](#review-commands)

## 上下文命令

用于管理 `.claude/context/` 中项目上下文的命令。

### `/context:create`
- **目的**：创建初始项目上下文文档
- **用法**：`/context:create`
- **描述**：分析项目结构并在 `.claude/context/` 中创建全面的基准文档。包括项目概述、架构、依赖关系和模式。
- **使用时机**：在项目开始时或需要完全重建上下文时
- **输出**：涵盖项目不同方面的多个上下文文件

### `/context:update`
- **目的**：使用最新更改更新现有上下文
- **用法**：`/context:update`
- **描述**：基于最近的代码更改、新功能或架构更新来刷新上下文文档。保留现有上下文并添加新信息。
- **使用时机**：在重大更改后或重要工作会话前
- **输出**：带有更改跟踪的更新上下文文件

### `/context:prime`
- **目的**：将上下文加载到当前对话中
- **用法**：`/context:prime`
- **描述**：读取所有上下文文件并将它们加载到当前对话的内存中。对于维持项目意识至关重要。
- **使用时机**：在任何工作会话开始时
- **输出**：已加载上下文的确认信息

## 测试命令

用于测试配置和执行的命令。

### `/testing:prime`
- **目的**：配置测试设置
- **用法**：`/testing:prime`
- **描述**：检测并配置项目的测试框架，创建测试配置，并准备测试运行代理。
- **使用时机**：初始项目设置或测试框架更改时
- **输出**：包含测试命令和模式的 `.claude/testing-config.md`

### `/testing:run`
- **目的**：使用智能分析执行测试
- **用法**：`/testing:run [test_target]`
- **描述**：使用测试运行代理运行测试，该代理将输出捕获到日志中，并仅返回基本结果以保持上下文。
- **选项**：
  - 无参数：运行所有测试
  - 文件路径：运行特定测试文件
  - 模式：运行匹配模式的测试
- **输出**：测试摘要，包含分析的失败信息，主线程中无详细输出

## 实用工具命令

通用实用工具和维护命令。

### `/prompt`
- **目的**：处理带有多个引用的复杂提示
- **用法**：将提示写入文件，然后输入 `/prompt`
- **描述**：当带有众多 @ 引用的复杂提示在直接输入中失败时的临时命令。提示首先写入命令文件，然后执行。
- **使用时机**：当 Claude 的 UI 拒绝复杂提示时
- **输出**：执行写入的提示

### `/re-init`
- **目的**：使用 PM 规则更新或创建 CLAUDE.md
- **用法**：`/re-init`
- **描述**：使用 `.claude/CLAUDE.md` 中的规则更新项目的 CLAUDE.md 文件，确保 Claude 实例具有正确的指令。
- **使用时机**：克隆 PM 系统后或更新规则后
- **输出**：项目根目录中的更新后 CLAUDE.md

## 审查命令

用于处理外部代码审查工具的命令。

### `/code-rabbit`
- **目的**：智能处理 CodeRabbit 审查评论
- **用法**：`/code-rabbit` 然后粘贴评论
- **描述**：以上下文感知方式评估 CodeRabbit 建议，接受有效的改进建议，同时忽略缺乏上下文的建议。为多文件审查生成并行代理。
- **功能**：
  - 理解 CodeRabbit 缺乏完整上下文
  - 接受：真实错误、安全问题、资源泄漏
  - 忽略：样式偏好、无关模式
  - 多文件并行处理
- **输出**：已接受/忽略建议的摘要，包含推理过程

## 命令模式

所有命令都遵循一致的模式：

### 允许的工具
每个命令在前言中指定所需的工具：
- `Read, Write, LS` - 文件操作
- `Bash` - 系统命令
- `Task` - 子代理生成
- `Grep` - 代码搜索

### 错误处理
命令遵循快速失败原则：
- 首先检查先决条件
- 提供解决方案的清晰错误消息
- 永不留下部分状态

### 上下文保护
处理大量信息的命令：
- 使用代理来保护主线程免受详细输出影响
- 返回摘要，而不是原始数据
- 仅保留必要信息

## 创建自定义命令

添加新命令的步骤：

1. **创建文件**：`commands/category/command-name.md`
2. **添加前言**：
   ```yaml
   ---
   allowed-tools: Read, Write, LS
   ---
   ```
3. **结构化内容**：
   - 目的和用法
   - 预检检查
   - 分步说明
   - 错误处理
   - 输出格式

4. **遵循模式**：
   - 保持简单（无过度验证）
   - 使用清晰消息快速失败
   - 使用代理进行重型处理
   - 返回简洁输出

## 与代理集成

命令通常使用代理进行繁重工作：

- **test-runner**：执行测试，分析结果
- **file-analyzer**：总结详细文件
- **code-analyzer**：在代码库中搜寻错误
- **parallel-worker**：协调并行执行

这样在执行复杂工作的同时保持主对话上下文的清洁。

## 注意事项

- 命令是作为指令解释的 markdown 文件
- `/` 前缀触发命令执行
- 命令可以生成代理用于上下文保护
- 所有 PM 命令（`/pm:*`）都在主 README 中有文档
- 命令遵循 `/rules/` 中定义的规则
